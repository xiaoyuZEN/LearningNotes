## （一）NSL-KDD数据集

改进：

（1）NSL-KDD数据集的训练集中不包含冗余记录，所以分类器不会偏向更频繁的记录；

（2）NSL-KDD数据集的测试集中没有重复的记录，使得检测率更为准确。

（3）来自每个难度级别组的所选记录的数量与原始KDD数据集中的记录的百分比成反比。结果，不同机器学习方法的分类率在更宽的范围内变化，这使得对不同学习技术的准确评估更有效。

（4）训练和测试中的记录数量设置是合理的，这使得在整套实验上运行实验成本低廉而无需随机选择一小部分。因此，不同研究工作的评估结果将是一致的和可比较的。

### 文件介绍

NSL-KDD 数据集共有 8 个文件，如下：

KDDTrain+.ARFF：完整 NSL-KDD 训练集，带有 ARFF 格式的二进制标签；

**KDDTrain+.TXT：完整的 NSL-KDD 训练集，包括 attack 的标签以及严重性；**

KDDTrain+_20Percent.ARFF： KDDTrain+.ARFF 文件的 20%的子集；

KDDTrain+_20Percent.TXT：KDDTrain+ _20Percent.TXT 文件的 20%的子集；

KDDTest+.ARFF：完整的 NSL-KDD 测试集，带有 ARFF 格式的二进制标签；

**KDDTest+.TXT：完整的 NSL-KDD 测试集，包括 attack 的标签以及严重性；**

KDDTest-21.ARFF：不带有严重性得分为 21 的 KDDTest+.ARFF 文件；

KDDTest-21.TXT：不带有严重性得分为 21 的 KDDTest+.TXT 文件

### 四大类异常类型 -以及部分小类别异常解释

供39种小类

- **DOS**拒绝服务攻击。资源消耗，其目的是使计算机或网络无法提供正常的服务。11
- **Smurf**：发送大量IP包，耗尽带宽。
  - **Pod**：发送大量畸形ping包，导致系统崩溃，对目标IP不停的ping 。
  - **Teardrop**：发送大量的、过大的错位IP碎片到被攻击的机器。造成操作系统崩溃。
  - **Land**：发送精心构造的、具有相同源地址和目标地址的欺骗[数据包](https://baike.baidu.com/item/数据包)，致使缺乏相应防护机制的目标设备瘫痪。
  - **Back**：针对Apache web服务器的反向拒绝服务攻击，其中客户端请求包含许多反斜杠的URL。
  - Neptune  Processtable  Udpstorm Mailbomb  apache2  Worm
  
- **Probe/Surveillance**, 端口监视或扫描。进行监视扫描，目的是偷取重要信息。6
  - ipsweep:对多个主机地址执行端口扫描或ping并监视。
  - Nmap:使用nmap工具进行nmap网络映射，包括SYN包（TCP连接第一个包）。
  - Portsweep:监视扫描许多端口，以确定在单个主机上支持哪些服务。
  - Satan:寻找已知弱点的Satan网络探测工具。
  - Mscan  Saint

- **R2L, **REMOTE-TO-LOCAL来自远程主机的未授权访问。 这是一个远程->本地, 是一个入侵的过程;15
  - ftp_write:远程ftp用户创建.rhost文件写匿名ftp目录中并获取本地登录名。
  - guess_passwd ：远程管理在服务器上的电子邮件/猜测密码。
  - imap ：使用imap端口的imap远程缓冲区溢出获得系统权限。
  - multihop：用户第一次闯入一台机器的多步活动。
  - spy：用户为了寻找重要信息而闯入机器的多天场景，用户试图避开检测使用几种不同的攻击方法获取访问。
  - warezclient：用户下载之前由WarezMaster通过匿名ftp发布的非法软件。
  - warezmaster：匿名上传非法软件到ftp服务器（通常是copywrited软件的非法副本）。
  - phf：利用的CGI脚本，允许客户机在配置错误的Web服务器上执行任意命令。
  - sendmail  Xlock Snmpguess  Named  Xsnoop  Snmpgetattack  httptunnel

- **U2R,**USER-TO-ROOT未授权的本地超级用户特权访问。这种攻击从普通用户帐户开始，然后尝试以 root 的身份访问系统或网络，其目的在于试图利用系统的漏洞来获取 root 访问权限；7
- Rootkit：一种特殊的恶意软件，它的功能是在安装目标上隐藏自身及指定的文件、进程和网络链接等信息。
  - buffer overflow：缓存溢出攻击，利用它执行非授权指令，甚至可以取得系统特权，进而进行各种非法操作。
- Loadmodule：为普通用户重置ifs并创建root权限的shell。
  - Perl：Perl攻击，在Perl脚本中将用户ID设置为根，并创建根shell。
- ps  sqlattack  xterm

注：测试集上出现了训练集中未出现的攻击类型，且不同攻击的样本在训练集和在测试集上占比是不同的，考察模型泛化能力。

### 特征值

一条记录43个字段，42号是标签，43号是严重性得分，其他字段具体含义如下：

#### 1.TCP连接基本特征1-9

（共9种，序号1～9）

基本连接特征包含了一些连接的基本属性，如连续时间，协议类型，传送的字节数等。

- **(1) duration** - 连接持续时间，以秒为单位，连续类型。范围是 [0, 58329] 。它的定义是从TCP连接以3次握手建立算起，到FIN/ACK连接结束为止的时间；若为UDP协议类型，则将每个UDP数据包作为一条连接。数据集中出现大量的duration = 0 的情况，是因为该条连接的持续时间不足1秒。
- **(2) protocol_type** - 协议类型，离散类型，共有3种：TCP, UDP, ICMP。
- **(3) service** - 目标主机的网络服务类型，离散类型，共有70种。’aol’, ‘auth’, ‘bgp’, ‘courier’, ‘csnet_ns’, ‘ctf’, ‘daytime’, ‘discard’, ‘domain’, ‘domain_u’, ‘echo’, ‘eco_i’, ‘ecr_i’, ‘efs’, ‘exec’, ‘finger’, ‘ftp’, ‘ftp_data’, ‘gopher’, ‘harvest’, ‘hostnames’, ‘http’, ‘http_2784′, ‘http_443′, ‘http_8001′, ‘imap4′, ‘IRC’, ‘iso_tsap’, ‘klogin’, ‘kshell’, ‘ldap’, ‘link’, ‘login’, ‘mtp’, ‘name’, ‘netbios_dgm’, ‘netbios_ns’, ‘netbios_ssn’, ‘netstat’, ‘nnsp’, ‘nntp’, ‘ntp_u’, ‘other’, ‘pm_dump’, ‘pop_2′, ‘pop_3′, ‘printer’, ‘private’, ‘red_i’, ‘remote_job’, ‘rje’, ‘shell’, ‘smtp’, ‘sql_net’, ‘ssh’, ‘sunrpc’, ‘supdup’, ‘systat’, ‘telnet’, ‘tftp_u’, ‘tim_i’, ‘time’, ‘urh_i’, ‘urp_i’, ‘uucp’, ‘uucp_path’, ‘vmnet’, ‘whois’, ‘X11′, ‘Z39_50′。
- **(4) flag** - 连接正常或错误的状态，离散类型，共11种。’OTH’, ‘REJ’, ‘RSTO’, ‘RSTOS0′, ‘RSTR’, ‘S0′, ‘S1′, ‘S2′, ‘S3′, ‘SF’, ‘SH’。它表示该连接是否按照协议要求开始或完成。例如SF表示连接正常建立并终止；S0表示只接到了SYN请求数据包，而没有后面的SYN/ACK。其中SF表示正常，其他10种都是error。
- **(5) src_bytes** - 从源主机到目标主机的数据的字节数，连续类型，范围是 [0, 1379963888]。
- **(6) dst_bytes** - 从目标主机到源主机的数据的字节数，连续类型，范围是 [0. 1309937401]。
- **(7) land** - 若连接来自/送达同一个主机/端口则为1，否则为0，离散类型，0或1。
- **(8) wrong_fragment** - 错误分段的数量，连续类型，范围是 [0, 3]。
- **(9) urgent** - 加急包的个数，连续类型，范围是[0, 14]。

#### 2.TCP连接的内容特征10-22

（共13种，序号10～22）

对于U2R和R2L之类的攻击，由于它们不像DoS攻击那样在数据记录中具有频繁序列模式，而一般都是嵌入在数据包的数据负载里面，单一的数据包和正常连接没有什么区别。为了检测这类攻击，Wenke Lee等从数据内容里面抽取了部分可能反映入侵行为的内容特征，如登录失败的次数等。

- **(10) hot** - 访问系统敏感文件和目录的次数，连续，范围是 [0, 101]。例如访问系统目录，建立或执行程序等。
- **(11) num_failed_logins** - 登录尝试失败的次数。连续，[0, 5]。
- **(12) logged_in** - 成功登录则为1，否则为0，离散，0或1。
- **(13) num_compromised** - compromised条件出现的次数，连续，[0, 7479]。
- **(14) root_shell** - 若获得root shell 则为1，否则为0，离散，0或1。root_shell是指获得超级用户权限。
- **(15) su_attempted** - 若出现”su root” 命令则为1，否则为0，离散，0或1。
- **(16) num_root** - root用户访问次数，连续，[0, 7468]。
- **(17) num_file_creations** - 文件创建操作的次数，连续，[0, 100]。
- **(18) num_shells** - 使用shell命令的次数，连续，[0, 5]。
- **(19) num_access_files** - 访问控制文件的次数，连续，[0, 9]。例如对 /etc/passwd 或 .rhosts 文件的访问。
- **(20) num_outbound_cmds** - 一个FTP会话中出站连接的次数，连续，0。数据集中这一特征出现次数为0。
- **(21) is_hot_login** - 登录是否属于“hot”列表，是为1，否则为0，离散，0或1。例如超级用户或管理员登录。
- **(22) is_guest_login** - 若是guest 登录则为1，否则为0，离散，0或1。

#### 3.基于时间的网络流量统计特征 23-31

（共9种，序号23～31）

由于网络攻击事件在时间上有很强的关联性，因此统计出当前连接记录与之前一段时间内的连接记录之间存在的某些联系，可以更好的反映连接之间的关系。这类特征又分为两种集合：一个是 “same host”特征，只观察在过去两秒内与当前连接有 **相同目标主机** 的连接，例如相同的连接数，在这些相同连接与当前连接有相同的服务的连接等等；另一个是 “same service”特征，只观察过去两秒内与当前连接有 **相同服务** 的连接，例如这样的连接有多少个，其中有多少出现SYN错误或者REJ错误。

- **(23) count** - 过去两秒内，与当前连接具有相同的目标主机的连接数，连续，[0, 511]。
- **(24) srv_count** - 过去两秒内，与当前连接具有相同服务的连接数，连续，[0, 511]。
- **(25) serror_rate** - 过去两秒内，在与当前连接具有相同目标主机的连接中，出现“SYN” 错误的连接的百分比，连续，[0.00, 1.00]。
- **(26) srv_serror_rate** - 过去两秒内，在与当前连接具有相同服务的连接中，出现“SYN” 错误的连接的百分比，连续，[0.00, 1.00]。
- **(27) rerror_rate** - 过去两秒内，在与当前连接具有相同目标主机的连接中，出现“REJ” 错误的连接的百分比，连续，[0.00, 1.00]。
- **(28) srv_rerror_rate** - 过去两秒内，在与当前连接具有相同服务的连接中，出现“REJ” 错误的连接的百分比，连续，[0.00, 1.00]。
- **(29) same_srv_rate** - 过去两秒内，在与当前连接具有相同目标主机的连接中，与当前连接具有相同服务的连接的百分比，连续，[0.00, 1.00]。
- **(30) diff_srv_rate** - 过去两秒内，在与当前连接具有相同目标主机的连接中，与当前连接具有不同服务的连接的百分比，连续，[0.00, 1.00]。
- **(31) srv_diff_host_rate** - 过去两秒内，在与当前连接具有相同服务的连接中，与当前连接具有不同目标主机的连接的百分比，连续，[0.00, 1.00]。

注意：这一大类特征中，23、25、27、29、30这5个特征是 “same host” 特征，前提都是与当前连接具有相同目标主机的连接；24、26、28、31这4个特征是 “same service” 特征，前提都是与当前连接具有相同服务的连接。

#### 4.基于主机的网络流量统计特征 32-41

（共10种，序号32～41）

基于时间的流量统计只是在过去两秒的范围内统计与当前连接之间的关系，而在实际入侵中，有些 Probing攻击使用慢速攻击模式来扫描主机或端口，当它们扫描的频率大于2秒的时候，基于时间的统计方法就无法从数据中找到关联。所以Wenke Lee等按照目标主机进行分类，使用一个具有100个连接的时间窗，统计当前连接之前100个连接记录中与当前连接具有 **相同目标主机** 的统计信息。

- **(32) dst_host_count** - 前100个连接中，与当前连接具有相同目标主机的连接数，连续，[0, 255]。
- **(33) dst_host_srv_count** - 前100个连接中，与当前连接具有相同目标主机相同服务的连接数，连续，[0, 255]。
- **(34) dst_host_same_srv_rate** - 前100个连接中，与当前连接具有相同目标主机相同服务的连接所占的百分比，连续，[0.00, 1.00]。
- **(35) dst_host_diff_srv_rate** - 前100个连接中，与当前连接具有相同目标主机不同服务的连接所占的百分比，连续，[0.00, 1.00]。
- **(36) dst_host_same_src_port_rate** - 前100个连接中，与当前连接具有相同目标主机相同源端口的连接所占的百分比，连续，[0.00, 1.00]。
- **(37) dst_host_srv_diff_host_rate** - 前100个连接中，与当前连接具有相同目标主机相同服务的连接中，与当前连接具有不同源主机的连接所占的百分比，连续，[0.00, 1.00]。
- **(38) dst_host_serror_rate** - 前100个连接中，与当前连接具有相同目标主机的连接中，出现SYN错误的连接所占的百分比，连续，[0.00, 1.00]。
- **(39) dst_host_srv_serror_rate** - 前100个连接中，与当前连接具有相同目标主机相同服务的连接中，出现SYN错误的连接所占的百分比，连续，[0.00, 1.00]。
- **(40) dst_host_rerror_rate** - 前100个连接中，与当前连接具有相同目标主机的连接中，出现REJ错误的连接所占的百分比，连续，[0.00, 1.00]。
- **(41) dst_host_srv_rerror_rate** - 前100个连接中，与当前连接具有相同目标主机相同服务的连接中，出现REJ错误的连接所占的百分比，连续，[0.00, 1.00]。

## （二）师兄工作

- 数据处理组    面对原始数据，从原始数据中提取有用信息。

  无监督学习算法给西门子数据集打标签，只能在公开数据集上看效果如何，不能确定检查出来的是否是真的异常。

  【想办法定义异常】技术文档进一步思路 ①可以根据聚类方法尝试将公共数据集进行处理后，分析有问题簇的特点，（因为我觉得同类型的异常应该会聚在一起）看看能不能对比西门子数据看出些问题。②周期检测（感觉西门子的机器很大一部分都是像服务器一样运行，网络访问行为应该有周期性--有待验证）异常可能不符合周期访问的特点。

  有问题---没有办法完全确定的什么数据在哪个范围区间内是异常。

- 数据分析组   有监督学习-在公开数据上训练模型或拿打过标签的数据集进行。看到目前RCNN、LightGBM、XGboost效果都还可以。

## （三）TO-DO

#### 知识回顾

①网络连接过程 ②DNS解析过程  --对应去深入理解这个数据集（最好能拿出数据出来进行分析，尝试去解释为什么它是这个异常）

#### 进一步实验

思路一：沿着师兄【想定义异常】的思路，聚类分析、周期检测去找异常的特点。

思路二：想在公开数据集上训练模型，学习最新的paper，选择一个理解并尝试复现。或者先尝试训练RCNN模型把这个流程过一遍。









------



